<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jessie Math - æ¯”ä¾‹å°ºå†’éšªé€²éš</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&family=Nunito:wght@800&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #f0f9ff; /* æ·ºè—èƒŒæ™¯ */
            background-image: radial-gradient(#bae6fd 1px, transparent 1px);
            background-size: 20px 20px;
        }

        /* å“ç‰Œ Logo å­—é«” */
        .brand-font {
            font-family: 'Nunito', sans-serif;
        }

        /* æ§åˆ¶é é¢åˆ‡æ›çš„ CSS Class */
        .hidden-section {
            display: none !important;
        }

        /* éŠæˆ²å¡ç‰‡ç‰¹æ•ˆ */
        .game-card {
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.95);
        }

        /* æŒ‰éˆ•å½ˆè·³å‹•ç•« */
        .btn-bounce:active {
            transform: scale(0.95);
        }

        /* è‡ªå®šç¾©æ²è»¸ */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1; 
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb {
            background: #cbd5e1; 
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8; 
        }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center pt-24 pb-4 px-4">

    <nav class="fixed top-0 left-0 w-full bg-white/95 backdrop-blur-sm shadow-sm border-b border-gray-100 z-50 py-2 px-4 md:px-8 flex justify-between items-center h-16 md:h-20 transition-all">
        <div class="flex items-center gap-2 md:gap-3">
            <div class="relative w-10 h-10 md:w-12 md:h-12 rounded-full border-[3px] border-orange-400 overflow-hidden bg-transparent flex-shrink-0">
                <img src="JESSIEMATH-Q.png" alt="Jessie Logo" class="w-full h-full object-cover object-top">
            </div>
            <span class="brand-font text-xl md:text-3xl font-extrabold text-slate-800 tracking-tight leading-none">
                Jessie Math
            </span>
        </div>

        <div class="flex items-center gap-2 md:gap-4">
            <a href="https://jessiemath0703-chu.github.io/website2/" class="group flex items-center gap-2 px-3 py-1.5 md:px-5 md:py-2 bg-white border border-gray-200 rounded-full hover:bg-gray-50 hover:border-blue-300 hover:shadow-sm transition-all text-gray-600 hover:text-blue-600 no-underline">
                <i class="fas fa-home text-blue-500 group-hover:scale-110 transition-transform"></i>
                <span class="text-xs md:text-base font-bold whitespace-nowrap">é¦–é </span>
            </a>
            <a href="https://jessiemath0703-chu.github.io/Game-Lobby/" class="group flex items-center gap-2 px-3 py-1.5 md:px-5 md:py-2 bg-white border border-gray-200 rounded-full hover:bg-gray-50 hover:border-blue-300 hover:shadow-sm transition-all text-gray-600 hover:text-blue-600 no-underline">
                <i class="fas fa-gamepad text-blue-500 group-hover:scale-110 transition-transform"></i>
                <span class="text-xs md:text-base font-bold whitespace-nowrap">éŠæˆ²å¤§å»³</span>
            </a>
        </div>
    </nav>


    <div class="game-card w-full max-w-lg rounded-3xl shadow-2xl overflow-hidden border-4 border-white relative flex flex-col" style="height: calc(100vh - 120px); min-height: 550px;">

        <div id="start-screen" class="flex-1 flex flex-col items-center justify-center p-8 space-y-6">
            <div class="text-center">
                <div class="w-24 h-24 bg-blue-500 rounded-full mx-auto mb-4 flex items-center justify-center text-4xl text-white shadow-lg animate-bounce">
                    <i class="fas fa-calculator"></i>
                </div>
                <h1 class="text-3xl md:text-4xl font-bold text-blue-800 tracking-wider">Jessie Math</h1>
                <p class="text-blue-500 mt-2 font-bold">æ•¸å­¸å†’éšªï¼šæ¯”ä¾‹èˆ‡ç¸®æ”¾</p>
            </div>

            <div class="w-full space-y-3">
                <input type="text" id="player-name" placeholder="è«‹è¼¸å…¥ä½ çš„åå­—" 
                    class="w-full px-6 py-4 rounded-xl border-2 border-blue-200 text-center text-xl focus:border-blue-500 focus:outline-none transition bg-white/50">
                
                <button onclick="goToMenu()" 
                    class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 rounded-xl shadow-lg transform transition btn-bounce text-xl">
                    é–‹å§‹å†’éšª <i class="fas fa-arrow-right ml-2"></i>
                </button>
                
                <button onclick="showInstructions()" 
                    class="w-full bg-white hover:bg-blue-50 text-blue-600 font-bold py-3 rounded-xl border-2 border-blue-100 hover:border-blue-300 transition text-lg flex items-center justify-center gap-2">
                    <i class="fas fa-book-open"></i> éŠæˆ²èªªæ˜
                </button>
            </div>
        </div>

        <div id="instruction-modal" class="hidden absolute inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4">
            <div class="bg-white rounded-2xl shadow-2xl w-full max-w-sm flex flex-col overflow-hidden animate-fade-in-up">
                <div class="bg-blue-600 p-4 text-white text-center font-bold text-xl relative">
                    <i class="fas fa-info-circle mr-2"></i> éŠæˆ²è¦å‰‡
                    <button onclick="hideInstructions()" class="absolute right-4 top-1/2 transform -translate-y-1/2 text-blue-200 hover:text-white">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <div class="p-6 space-y-4 text-gray-700 text-sm md:text-base overflow-y-auto max-h-[60vh]">
                    <div class="flex items-start gap-3">
                        <div class="bg-purple-100 text-purple-600 p-2 rounded-lg shrink-0"><i class="fas fa-shapes"></i></div>
                        <div>
                            <h4 class="font-bold text-gray-800">éŠæˆ²å…§å®¹</h4>
                            <p class="text-gray-500 text-xs md:text-sm mt-1">æŒ‘æˆ°ã€Œå·¨äººåœ‹(æ”¾å¤§)ã€èèŸ»åœ‹(ç¸®å°)ã€éŒ¯èª¤å¯¦é©—å®¤(æ¯”ä¾‹å°º)ã€ä¸‰å¤§é—œå¡ï¼Œæ´»ç”¨æ•¸å­¸è§£æ±ºé›£é¡Œï¼</p>
                        </div>
                    </div>
                    
                    <div class="flex items-start gap-3">
                        <div class="bg-yellow-100 text-yellow-600 p-2 rounded-lg shrink-0"><i class="fas fa-stopwatch"></i></div>
                        <div>
                            <h4 class="font-bold text-gray-800">éŠæˆ²æ™‚é–“</h4>
                            <p class="text-gray-500 text-xs md:text-sm mt-1">æ¯å±€é™æ™‚ <span class="text-red-500 font-bold">60 ç§’</span>ã€‚æ‰‹è…³è¦å¿«ï¼Œå¤§è…¦è¦æ›´æ¸…é†’ï¼</p>
                        </div>
                    </div>

                    <div class="flex items-start gap-3">
                        <div class="bg-green-100 text-green-600 p-2 rounded-lg shrink-0"><i class="fas fa-trophy"></i></div>
                        <div>
                            <h4 class="font-bold text-gray-800">è¨ˆåˆ†æ–¹å¼</h4>
                            <ul class="text-gray-500 text-xs md:text-sm mt-1 space-y-1 list-disc pl-4">
                                <li>ç­”å°ï¼šç²å¾— <span class="font-bold text-green-600">100åˆ†</span> + æ™‚é–“çå‹µ <span class="font-bold text-green-600">2ç§’</span>ã€‚</li>
                                <li>é€£æ“Š (Combo)ï¼šé€£çºŒç­”å°åˆ†æ•¸æœƒåŠ å€ï¼</li>
                                <li>ç­”éŒ¯ï¼šé€£æ“Šä¸­æ–·ï¼Œä¸æ‰£åˆ†ã€‚</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <div class="p-4 border-t border-gray-100">
                    <button onclick="hideInstructions()" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-xl shadow-md transition">
                        æˆ‘æº–å‚™å¥½äº†ï¼
                    </button>
                </div>
            </div>
        </div>


        <div id="menu-screen" class="hidden-section flex-1 flex flex-col p-6 h-full">
            <header class="flex justify-between items-center mb-4 flex-shrink-0">
                <div>
                    <p class="text-gray-500 text-xs md:text-sm">æ­¡è¿å›ä¾†,</p>
                    <h2 id="display-name" class="text-xl md:text-2xl font-bold text-blue-800">ç©å®¶</h2>
                </div>
                <div class="bg-yellow-100 text-yellow-700 px-3 py-1 rounded-full text-xs md:text-sm font-bold">
                    <i class="fas fa-crown mr-1"></i> æ’è¡Œæ¦œ
                </div>
            </header>

            <div class="flex justify-center space-x-4 mb-6 flex-shrink-0">
                <button id="btn-normal" onclick="setDifficulty('normal')" class="px-4 py-1.5 md:px-6 md:py-2 text-sm md:text-base rounded-full font-bold border-2 bg-green-50 text-green-700 border-green-400">æ™®é€š</button>
                <button id="btn-hard" onclick="setDifficulty('hard')" class="px-4 py-1.5 md:px-6 md:py-2 text-sm md:text-base rounded-full font-bold border-2 text-gray-400 border-gray-200">å›°é›£</button>
            </div>

            <div class="grid grid-cols-2 gap-3 md:gap-4 mb-6 flex-shrink-0">
                <button onclick="startGame(1)" class="p-3 md:p-4 bg-white border-2 border-blue-100 rounded-xl hover:border-blue-400 hover:shadow-md transition text-left group">
                    <div class="text-xl md:text-2xl mb-1 group-hover:scale-110 transition">ğŸ”­</div>
                    <div class="font-bold text-gray-700 text-sm md:text-base">å·¨äººåœ‹</div>
                    <div class="text-[10px] md:text-xs text-gray-400">æ”¾å¤§èˆ‡å€æ•¸</div>
                </button>
                <button onclick="startGame(2)" class="p-3 md:p-4 bg-white border-2 border-blue-100 rounded-xl hover:border-blue-400 hover:shadow-md transition text-left group">
                    <div class="text-xl md:text-2xl mb-1 group-hover:scale-110 transition">ğŸœ</div>
                    <div class="font-bold text-gray-700 text-sm md:text-base">èèŸ»åœ‹</div>
                    <div class="text-[10px] md:text-xs text-gray-400">ç¸®å°èˆ‡æ¨¡å‹</div>
                </button>
                <button onclick="startGame(3)" class="p-3 md:p-4 bg-white border-2 border-blue-100 rounded-xl hover:border-blue-400 hover:shadow-md transition text-left group">
                    <div class="text-xl md:text-2xl mb-1 group-hover:scale-110 transition">ğŸ—ºï¸</div>
                    <div class="font-bold text-gray-700 text-sm md:text-base">éŒ¯èª¤å¯¦é©—å®¤</div>
                    <div class="text-[10px] md:text-xs text-gray-400">åœ°åœ–èˆ‡æ¯”ä¾‹å°º</div>
                </button>
                <button onclick="startGame(4)" class="p-3 md:p-4 bg-gradient-to-br from-purple-500 to-indigo-600 text-white rounded-xl shadow-lg hover:shadow-xl transition text-left relative overflow-hidden">
                    <div class="absolute top-0 right-0 p-2 opacity-20 text-3xl">?</div>
                    <div class="text-xl md:text-2xl mb-1">âš¡</div>
                    <div class="font-bold text-sm md:text-base">æ™‚ç©ºæ··äº‚</div>
                    <div class="text-[10px] md:text-xs text-purple-200">ç¶œåˆæŒ‘æˆ°</div>
                </button>
            </div>

            <div class="bg-white rounded-xl p-3 border border-gray-100 flex-1 overflow-y-auto min-h-0">
                <h3 class="text-xs font-bold text-gray-400 uppercase mb-2 sticky top-0 bg-white pb-1">å†’éšªè€…æ’è¡Œ</h3>
                <ul id="leaderboard-list" class="space-y-2 text-xs md:text-sm text-gray-600">
                    <li class="text-center text-gray-400 py-4">æš«ç„¡ç´€éŒ„</li>
                </ul>
            </div>
        </div>

        <div id="game-screen" class="hidden-section flex-1 flex flex-col relative h-full">
            <div class="bg-blue-600 p-3 md:p-4 text-white flex justify-between items-center shadow-md z-10 flex-shrink-0">
                <div class="flex items-center space-x-3 md:space-x-4">
                    <button onclick="pauseGame()" class="hover:bg-blue-500 p-2 rounded-lg transition"><i class="fas fa-pause"></i></button>
                    <div>
                        <div class="text-[10px] md:text-xs text-blue-200" id="level-title">ç¬¬ä¸€é—œ</div>
                        <div class="font-bold text-lg md:text-xl"><i class="fas fa-star text-yellow-300 mr-1"></i> <span id="score-display">0</span></div>
                    </div>
                </div>
                <div class="text-xl md:text-2xl font-mono font-bold bg-blue-800 px-3 py-1 rounded-lg border border-blue-400" id="timer-display">60</div>
            </div>

            <div class="flex-1 p-4 md:p-6 flex flex-col justify-center items-center bg-white overflow-y-auto">
                <div class="text-5xl md:text-6xl mb-4 md:mb-6 animate-pulse" id="question-image">ğŸ”­</div>
                <h3 class="text-lg md:text-2xl font-bold text-center text-gray-800 leading-relaxed" id="question-text">
                    é¡Œç›®è¼‰å…¥ä¸­...
                </h3>
            </div>

            <div class="p-3 md:p-4 bg-gray-50 rounded-t-3xl border-t border-gray-200 flex-shrink-0">
                <div id="options-grid" class="grid grid-cols-2 gap-2 md:gap-3">
                    </div>
            </div>

            <div id="pause-modal" class="hidden absolute inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center">
                <div class="bg-white p-6 rounded-2xl shadow-2xl w-3/4 max-w-sm text-center">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6">éŠæˆ²æš«åœ</h2>
                    <div class="space-y-3">
                        <button onclick="resumeGame()" class="w-full bg-green-500 hover:bg-green-600 text-white py-3 rounded-xl font-bold">ç¹¼çºŒå†’éšª</button>
                        <button onclick="resetGame()" class="w-full bg-yellow-500 hover:bg-yellow-600 text-white py-3 rounded-xl font-bold">é‡æ–°é–‹å§‹</button>
                        <button onclick="backToMenu()" class="w-full bg-gray-200 hover:bg-gray-300 text-gray-600 py-3 rounded-xl font-bold">å›ä¸»é¸å–®</button>
                    </div>
                </div>
            </div>
        </div>

        <div id="result-screen" class="hidden-section flex-1 flex flex-col items-center justify-center p-8 text-center bg-gradient-to-b from-blue-50 to-white">
            <div class="text-6xl mb-4">ğŸ†</div>
            <h2 class="text-3xl font-bold text-gray-800 mb-2">å†’éšªçµæŸï¼</h2>
            <p class="text-gray-500 mb-8">åšå¾—å¥½ï¼Œ<span id="result-name" class="font-bold text-blue-600"></span>ï¼</p>
            
            <div class="bg-white p-6 rounded-2xl shadow-xl border-2 border-blue-100 w-full mb-8">
                <p class="text-sm text-gray-400 uppercase tracking-wide">æœ€çµ‚å¾—åˆ†</p>
                <p class="text-5xl font-black text-blue-600 mt-2" id="final-score">0</p>
            </div>

            <button onclick="backToMenu()" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 rounded-xl shadow-lg transform transition btn-bounce">
                å†ç©ä¸€æ¬¡
            </button>
        </div>

    </div>

    <script>
        // éŠæˆ²ç‹€æ…‹è®Šæ•¸
        let gameState = {
            playerName: '',
            difficulty: 'normal',
            currentLevel: 1,
            score: 0,
            timeLeft: 60,
            isPlaying: false,
            isPaused: false,
            timerInterval: null,
            combo: 0
        };

        let leaderboard = JSON.parse(localStorage.getItem('jessieMathLeaderboard')) || [];

        const screens = {
            start: document.getElementById('start-screen'),
            menu: document.getElementById('menu-screen'),
            game: document.getElementById('game-screen'),
            result: document.getElementById('result-screen')
        };

        // --- æ–°å¢ï¼šæ§åˆ¶éŠæˆ²èªªæ˜çš„å‡½å¼ ---
        function showInstructions() {
            document.getElementById('instruction-modal').classList.remove('hidden');
        }

        function hideInstructions() {
            document.getElementById('instruction-modal').classList.add('hidden');
        }

        function showScreen(screenName) {
            Object.values(screens).forEach(el => el.classList.add('hidden-section'));
            screens[screenName].classList.remove('hidden-section');
            if(screenName === 'menu') {
                renderLeaderboard();
            }
        }

        function goToMenu() {
            const nameInput = document.getElementById('player-name').value.trim();
            if (!nameInput) {
                alert("è«‹è¼¸å…¥åå­—æ‰èƒ½é–‹å§‹å†’éšªå–”ï¼");
                return;
            }
            gameState.playerName = nameInput;
            document.getElementById('display-name').textContent = gameState.playerName;
            showScreen('menu');
        }

        function setDifficulty(diff) {
            gameState.difficulty = diff;
            document.getElementById('btn-normal').className = `px-4 py-1.5 md:px-6 md:py-2 text-sm md:text-base rounded-full font-bold border-2 transition ${diff === 'normal' ? 'bg-green-50 text-green-700 border-green-400 ring-2 ring-green-200' : 'text-gray-400 border-gray-200'}`;
            document.getElementById('btn-hard').className = `px-4 py-1.5 md:px-6 md:py-2 text-sm md:text-base rounded-full font-bold border-2 transition ${diff === 'hard' ? 'bg-red-50 text-red-700 border-red-400 ring-2 ring-red-200' : 'text-gray-400 border-gray-200'}`;
        }

        function backToMenu() {
            clearInterval(gameState.timerInterval);
            document.getElementById('pause-modal').classList.add('hidden');
            showScreen('menu');
        }

        function startGame(level) {
            gameState.currentLevel = level;
            gameState.score = 0;
            gameState.timeLeft = 60;
            gameState.isPlaying = true;
            gameState.isPaused = false;
            gameState.combo = 0;
            
            const titles = ["ç¬¬ä¸€é—œï¼šå·¨äººåœ‹", "ç¬¬äºŒé—œï¼šèèŸ»åœ‹", "ç¬¬ä¸‰é—œï¼šéŒ¯èª¤å¯¦é©—å®¤", "ç¬¬å››é—œï¼šæ™‚ç©ºæ··äº‚"];
            document.getElementById('level-title').textContent = titles[level - 1];
            
            updateUI();
            showScreen('game');
            nextQuestion();
            
            if(gameState.timerInterval) clearInterval(gameState.timerInterval);
            gameState.timerInterval = setInterval(() => {
                if(!gameState.isPaused) {
                    gameState.timeLeft--;
                    updateUI();
                    if(gameState.timeLeft <= 0) endGame();
                }
            }, 1000); 
        }

        function pauseGame() {
            gameState.isPaused = true;
            document.getElementById('pause-modal').classList.remove('hidden');
        }

        function resumeGame() {
            gameState.isPaused = false;
            document.getElementById('pause-modal').classList.add('hidden');
        }

        function resetGame() {
            document.getElementById('pause-modal').classList.add('hidden');
            startGame(gameState.currentLevel);
        }

        function updateUI() {
            document.getElementById('score-display').textContent = gameState.score;
            document.getElementById('timer-display').textContent = gameState.timeLeft;
            const timerEl = document.getElementById('timer-display');
            if(gameState.timeLeft < 10) {
                timerEl.classList.add('bg-red-600', 'animate-pulse');
                timerEl.classList.remove('bg-blue-800');
            } else {
                timerEl.classList.remove('bg-red-600', 'animate-pulse');
                timerEl.classList.add('bg-blue-800');
            }
        }

        function endGame() {
            clearInterval(gameState.timerInterval);
            gameState.isPlaying = false;
            document.getElementById('result-name').textContent = gameState.playerName;
            document.getElementById('final-score').textContent = gameState.score;
            saveScore();
            renderLeaderboard();
            showScreen('result');
        }

        function saveScore() {
            leaderboard.push({
                name: gameState.playerName,
                score: gameState.score,
                level: gameState.currentLevel,
                date: new Date().toLocaleDateString()
            });
            leaderboard.sort((a, b) => b.score - a.score);
            leaderboard = leaderboard.slice(0, 10);
            localStorage.setItem('jessieMathLeaderboard', JSON.stringify(leaderboard));
        }

        function renderLeaderboard() {
            const list = document.getElementById('leaderboard-list');
            if (leaderboard.length === 0) {
                list.innerHTML = '<li class="text-center text-gray-400 py-4">æš«ç„¡ç´€éŒ„ï¼Œå¿«ä¾†æŒ‘æˆ°ï¼</li>';
                return;
            }
            list.innerHTML = leaderboard.map((entry, index) => {
                let medal = '';
                if(index === 0) medal = 'ğŸ¥‡';
                else if(index === 1) medal = 'ğŸ¥ˆ';
                else if(index === 2) medal = 'ğŸ¥‰';
                else medal = `<span class="text-gray-400 font-mono w-6 inline-block text-center">${index+1}</span>`;
                
                return `<li class="flex justify-between items-center border-b border-gray-100 py-2 last:border-0">
                    <div class="flex items-center">
                        <span class="mr-2 text-lg">${medal}</span>
                        <span class="font-medium text-gray-700">${entry.name} <span class="text-[10px] text-gray-400 bg-gray-100 px-1 rounded">Lv.${entry.level}</span></span>
                    </div>
                    <span class="font-bold text-blue-600 font-mono">${entry.score}</span>
                </li>`;
            }).join('');
        }

        function nextQuestion() {
            const level = gameState.currentLevel;
            let qData = {};
            switch(level) {
                case 1: qData = generateLevel1(); break;
                case 2: qData = generateLevel2(); break;
                case 3: qData = generateLevel3(); break;
                case 4: 
                    const randomType = Math.floor(Math.random() * 3) + 1;
                    if(randomType === 1) qData = generateLevel1();
                    else if(randomType === 2) qData = generateLevel2();
                    else qData = generateLevel3();
                    break;
            }
            renderQuestion(qData);
        }

        function randInt(min, max) {
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }

        function generateLevel1() {
            const type = randInt(1, 3); const items = ["æ¨‚é«˜äºº", "æ©¡çš®æ“¦", "æ‰‹æ©Ÿ", "æ¹¯åŒ™", "çœ¼é¡"]; const item = items[randInt(0, items.length - 1)];
            let baseSize, scale, ans;
            if (type === 1) { baseSize = randInt(2, 9); scale = [2, 3, 4, 5, 10][randInt(0, 4)]; ans = baseSize * scale; return { text: `é­”æ³•æ”¾å¤§ï¼åŸæœ¬é•·åº¦ <span class="text-blue-600 text-2xl font-bold mx-1">${baseSize}</span> cm çš„${item}ï¼Œè¢«<span class="text-red-500 font-bold mx-1">æ”¾å¤§ ${scale} å€</span>ï¼Œç¾åœ¨å¤šé•·ï¼Ÿ`, icon: 'ğŸ”­', correct: `${ans} cm`, options: shuffle([`${ans} cm`, `${baseSize + scale} cm`, `${ans + 10} cm`, `${baseSize * (scale - 1)} cm`]) }; } 
            else if (type === 2) { baseSize = randInt(2, 8); scale = randInt(2, 5); let finalSize = baseSize * scale; return { text: `é€™æ”¯${item}è¢«æ”¾å¤§äº† <span class="text-red-500 font-bold mx-1">${scale} å€</span>ï¼Œç¾åœ¨æ˜¯ <span class="text-blue-600 text-2xl font-bold mx-1">${finalSize}</span> cmã€‚è«‹å•å®ƒ<b>åŸæœ¬</b>å¤šé•·ï¼Ÿ`, icon: 'ğŸ”™', correct: `${baseSize} cm`, options: shuffle([`${baseSize} cm`, `${finalSize - scale} cm`, `${finalSize + scale} cm`, `${baseSize * 2} cm`]) }; } 
            else { baseSize = randInt(2, 5); scale = [2, 3, 4, 5, 8][randInt(0, 4)]; let finalSize = baseSize * scale; return { text: `é¡¯å¾®é¡ä¸‹çš„${item}åŸæœ¬ <span class="text-blue-600 font-bold mx-1">${baseSize}</span> cmï¼Œç¾åœ¨çœ‹æ˜¯ <span class="text-blue-600 text-2xl font-bold mx-1">${finalSize}</span> cmã€‚é€™æ˜¯æ”¾å¤§äº†å¹¾å€ï¼Ÿ`, icon: 'ğŸ”¬', correct: `${scale} å€`, options: shuffle([`${scale} å€`, `${scale + 2} å€`, `${scale * 2} å€`, `${finalSize - baseSize} å€`]) }; }
        }
        function generateLevel2() {
            const type = randInt(1, 3);
            if (type === 1) { const realM = randInt(5, 15) * 2; const paperCm = [15, 20, 30][randInt(0, 2)]; const realCm = realM * 100; const limitRatio = realCm / paperCm; let correctScaleBase = Math.ceil(limitRatio / 10) * 10 + (randInt(0,1)*10); if(correctScaleBase % 50 !== 0) correctScaleBase = Math.ceil(correctScaleBase/50)*50; let wrongScale = Math.floor(limitRatio / 2); return { text: `å»ºç¯‰ä»»å‹™ï¼šç‰†å£é•· <span class="text-blue-600 font-bold mx-1">${realM} m</span>ï¼Œç´™å¼µå¯¬ <span class="text-blue-600 font-bold mx-1">${paperCm} cm</span>ã€‚<br>é¸å“ªå€‹æ¯”ä¾‹å°ºæ‰èƒ½<b>å®Œæ•´ç•«é€²å»</b>ï¼Ÿ`, icon: 'ğŸ“', correct: `1 : ${correctScaleBase}`, options: shuffle([`1 : ${correctScaleBase}`, `1 : ${wrongScale}`, `1 : 1`, `1 : 5`]) }; } 
            else if (type === 2) { let realM = randInt(3, 6); let scale = [20, 30, 40, 50][randInt(0, 3)]; let modelCm = (realM * 100) / scale; while (modelCm % 1 !== 0) { realM = randInt(3, 6); scale = [20, 25, 40, 50][randInt(0, 3)]; modelCm = (realM * 100) / scale; } return { text: `è£½ä½œæ¨¡å‹è»Šï¼šçœŸè»Šé•· <span class="text-blue-600 font-bold mx-1">${realM} m</span>ï¼Œæ¯”ä¾‹å°ºæ˜¯ <span class="text-green-600 font-bold mx-1">1 : ${scale}</span>ã€‚<br>æ¨¡å‹è»Šæ‡‰è©²åšå¤šé•·ï¼Ÿ`, icon: 'ğŸï¸', correct: `${modelCm} cm`, options: shuffle([`${modelCm} cm`, `${modelCm * 10} cm`, `${realM * 10} cm`, `${modelCm / 2} cm`]) }; } 
            else { let original = randInt(20, 50); let ratioText = ["1/2", "1/4", "1/5", "1/10"][randInt(0, 3)]; let ratioVal = eval(ratioText); while (original * ratioVal % 1 !== 0) original = randInt(20, 60); let ans = original * ratioVal; return { text: `å½±å°æ©ŸæŒ‰ä¸‹äº†ã€Œç¸®å°å€ç‡ <span class="text-green-600 font-bold mx-1 text-2xl">${ratioText}</span>ã€ã€‚<br>åŸæœ¬å¯¬ ${original} cm çš„åœ–æ¡ˆï¼Œå°å‡ºä¾†æœƒè®Šå¤šå¯¬ï¼Ÿ`, icon: 'ğŸ–¨ï¸', correct: `${ans} cm`, options: shuffle([`${ans} cm`, `${ans * 2} cm`, `${original - 10} cm`, `${original} cm`]) }; }
        }
        function generateLevel3() {
            const type = randInt(1, 3);
            if (type === 1) { const scale = [100, 200, 500, 1000][randInt(0, 3)]; const mapCm = randInt(2, 8); const actualM = (mapCm * scale) / 100; return { text: `åœ°åœ–æ¯”ä¾‹å°º <span class="text-purple-600 font-bold mx-1">1 : ${scale}</span>ï¼Œåœ–ä¸Šè·é›¢ <span class="text-purple-600 font-bold mx-1">${mapCm} cm</span>ã€‚<br>è«‹å•<b>å¯¦éš›è·é›¢</b>æ˜¯å¤šå°‘ï¼Ÿ`, icon: 'ğŸ—ºï¸', correct: `${actualM} m`, options: shuffle([`${actualM} m`, `${actualM * 100} m`, `${mapCm} m`, `${actualM / 10} m`]) }; } 
            else if (type === 2) { const scale = [1000, 2000, 5000][randInt(0, 2)]; const actualKm = randInt(1, 5); let mapCm = (actualKm * 100000) / scale; while(mapCm > 100 || mapCm % 1 !== 0) { scale = [10000, 20000, 50000][randInt(0, 2)]; mapCm = (actualKm * 100000) / scale; } return { text: `ç¹ªè£½åœ°åœ–ï¼šå¯¦éš›è·é›¢ <span class="text-blue-600 font-bold mx-1">${actualKm} km</span>ï¼Œæ¯”ä¾‹å°ºç”¨ <span class="text-purple-600 font-bold mx-1">1 : ${scale}</span>ã€‚<br>åœ¨åœ°åœ–ä¸Šè¦ç•«å¹¾å…¬åˆ†ï¼Ÿ`, icon: 'âœï¸', correct: `${mapCm} cm`, options: shuffle([`${mapCm} cm`, `${mapCm * 10} cm`, `${mapCm / 10} cm`, `${actualKm} cm`]) }; } 
            else { const mapCm = randInt(5, 10); const scaleVal = [10, 50, 100, 200][randInt(0, 3)]; const realCm = mapCm * scaleVal; const realM = realCm / 100; return { text: `ã€åµæ¢é¡Œã€‘åœ°åœ–ç ´æ‰äº†ï¼å·²çŸ¥åœ–ä¸Š <span class="text-purple-600 font-bold mx-1">${mapCm} cm</span> ä»£è¡¨å¯¦éš› <span class="text-blue-600 font-bold mx-1">${realM} m</span>ã€‚<br>é€™å¼µåœ°åœ–çš„æ¯”ä¾‹å°ºæ˜¯å¤šå°‘ï¼Ÿ`, icon: 'ğŸ”', correct: `1 : ${scaleVal}`, options: shuffle([`1 : ${scaleVal}`, `1 : ${scaleVal * 10}`, `1 : ${scaleVal / 2}`, `1 : 1000`]) }; }
        }

        function shuffle(array) {
            let currentIndex = array.length,  randomIndex;
            while (currentIndex != 0) {
                randomIndex = Math.floor(Math.random() * currentIndex);
                currentIndex--;
                [array[currentIndex], array[randomIndex]] = [array[randomIndex], array[currentIndex]];
            }
            return array;
        }

        function renderQuestion(qData) {
            document.getElementById('question-text').innerHTML = qData.text;
            document.getElementById('question-image').textContent = qData.icon;
            const grid = document.getElementById('options-grid');
            grid.innerHTML = '';
            qData.options.forEach(opt => {
                const btn = document.createElement('button');
                btn.className = "bg-white hover:bg-blue-50 text-blue-800 font-bold py-3 px-2 md:py-4 md:px-2 rounded-xl border-b-4 border-blue-200 active:border-b-0 active:mt-1 transition-all text-base md:text-lg shadow-sm w-full h-full flex items-center justify-center leading-tight";
                btn.innerHTML = opt;
                btn.onclick = () => checkAnswer(opt, qData.correct, btn);
                grid.appendChild(btn);
            });
        }

        function checkAnswer(selected, correct, btnElement) {
            const allBtns = document.getElementById('options-grid').children;
            for(let btn of allBtns) btn.disabled = true;

            if(selected === correct) {
                btnElement.className = "bg-green-500 text-white font-bold py-3 px-2 md:py-4 md:px-2 rounded-xl border-b-4 border-green-700 shadow-lg w-full h-full flex items-center justify-center animate-pulse text-base md:text-lg";
                gameState.combo++;
                let points = 100 + (gameState.combo > 1 ? (gameState.combo * 20) : 0);
                if(gameState.difficulty === 'hard') points = Math.floor(points * 1.5);
                gameState.score += points;
                gameState.timeLeft += 2; 
                btnElement.innerHTML += ' <i class="fas fa-check-circle ml-2"></i>';
            } else {
                btnElement.className = "bg-red-500 text-white font-bold py-3 px-2 md:py-4 md:px-2 rounded-xl border-b-4 border-red-700 shadow-lg w-full h-full flex items-center justify-center shake text-base md:text-lg";
                gameState.combo = 0;
                for(let btn of allBtns) {
                    if(btn.textContent.includes(correct.replace(' <i class="fas fa-check-circle ml-2"></i>', ''))) { 
                        btn.classList.add('bg-green-100', 'border-green-400', 'text-green-800');
                    }
                }
            }
            updateUI();
            setTimeout(() => {
                if(gameState.isPlaying) nextQuestion();
            }, 1200);
        }
    </script>
</body>

</html>
